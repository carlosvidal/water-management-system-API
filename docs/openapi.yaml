openapi: 3.0.0
info:
  title: AquaFlow API
  version: 1.0.0
  description: >-
    Water Management System API - Comprehensive solution for condominium water
    consumption tracking, billing, and management.
  contact:
    name: AquaFlow Support
    email: support@aquaflow.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://api.aquaflow.com/api
    description: Production server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'JWT token for authentication. Use format: Bearer <token>'
  schemas:
    Error:
      type: object
      properties:
        message:
          type: string
          description: Error message
        error:
          type: string
          description: Error code or type
        details:
          type: object
          description: Additional error details
      required:
        - message
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User unique identifier
        email:
          type: string
          format: email
          description: User email address
        name:
          type: string
          description: User full name
        phone:
          type: string
          nullable: true
          description: User phone number
        role:
          type: string
          enum:
            - SUPER_ADMIN
            - ADMIN
            - ANALYST
            - EDITOR
            - RESIDENT
          description: User role in the system
        isActive:
          type: boolean
          description: Whether the user is active
        createdAt:
          type: string
          format: date-time
          description: User creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: User last update timestamp
      required:
        - id
        - email
        - name
        - role
        - isActive
    Condominium:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Condominium unique identifier
        name:
          type: string
          description: Condominium name
        address:
          type: string
          description: Condominium physical address
        city:
          type: string
          nullable: true
          description: City where the condominium is located
        country:
          type: string
          nullable: true
          description: Country where the condominium is located
        readingDay:
          type: integer
          minimum: 1
          maximum: 31
          nullable: true
          description: Day of the month for meter readings
        bankAccount:
          type: string
          nullable: true
          description: Bank account for payments
        bankAccountHolder:
          type: string
          nullable: true
          description: Name of the bank account holder
        isActive:
          type: boolean
          description: Whether the condominium is active
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
      required:
        - id
        - name
        - address
        - isActive
    Block:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Block unique identifier
        name:
          type: string
          description: Block name or identifier
        description:
          type: string
          nullable: true
          description: Block description
        condominiumId:
          type: string
          format: uuid
          description: ID of the condominium this block belongs to
        maxUnits:
          type: integer
          minimum: 1
          nullable: true
          description: Maximum number of units in this block
      required:
        - id
        - name
        - condominiumId
    Unit:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unit unique identifier
        name:
          type: string
          description: Unit name or number
        blockId:
          type: string
          format: uuid
          description: ID of the block this unit belongs to
        residentId:
          type: string
          format: uuid
          nullable: true
          description: ID of the resident assigned to this unit
        area:
          type: number
          format: float
          minimum: 0
          nullable: true
          description: Unit area in square meters
        isActive:
          type: boolean
          description: Whether the unit is active
      required:
        - id
        - name
        - blockId
        - isActive
    Resident:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Resident unique identifier
        name:
          type: string
          description: Resident full name
        email:
          type: string
          format: email
          description: Resident email address
        phone:
          type: string
          nullable: true
          description: Resident phone number
        document:
          type: string
          nullable: true
          description: Resident identification document
        condominiumId:
          type: string
          format: uuid
          description: ID of the condominium
        isActive:
          type: boolean
          description: Whether the resident is active
      required:
        - id
        - name
        - email
        - condominiumId
        - isActive
    Period:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Period unique identifier
        name:
          type: string
          description: Period name (e.g., "March 2024")
        condominiumId:
          type: string
          format: uuid
          description: ID of the condominium
        startDate:
          type: string
          format: date
          description: Period start date
        endDate:
          type: string
          format: date
          description: Period end date
        status:
          type: string
          enum:
            - ACTIVE
            - CLOSED
            - PROCESSING
          description: Current status of the period
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
      required:
        - id
        - name
        - condominiumId
        - startDate
        - endDate
        - status
    Reading:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Reading unique identifier
        unitId:
          type: string
          format: uuid
          description: ID of the unit
        periodId:
          type: string
          format: uuid
          description: ID of the billing period
        meterId:
          type: string
          format: uuid
          description: ID of the water meter
        value:
          type: number
          format: float
          minimum: 0
          description: Meter reading value in cubic meters
        previousValue:
          type: number
          format: float
          minimum: 0
          nullable: true
          description: Previous meter reading value
        consumption:
          type: number
          format: float
          minimum: 0
          nullable: true
          description: Calculated consumption (current - previous)
        photo1:
          type: string
          nullable: true
          description: URL of first photo taken
        photo2:
          type: string
          nullable: true
          description: URL of second photo taken
        notes:
          type: string
          nullable: true
          description: Additional notes about the reading
        isAnomalous:
          type: boolean
          description: Whether this reading is flagged as anomalous
        isValidated:
          type: boolean
          description: Whether this reading has been validated
        readingDate:
          type: string
          format: date-time
          description: Date and time when reading was taken
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        validatedAt:
          type: string
          format: date-time
          nullable: true
          description: Validation timestamp
        validatedBy:
          type: string
          format: uuid
          nullable: true
          description: ID of user who validated this reading
      required:
        - id
        - unitId
        - periodId
        - meterId
        - value
        - isAnomalous
        - isValidated
        - readingDate
    Bill:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Bill unique identifier
        unitId:
          type: string
          format: uuid
          description: ID of the unit
        periodId:
          type: string
          format: uuid
          description: ID of the billing period
        consumption:
          type: number
          format: float
          minimum: 0
          description: Water consumption in cubic meters
        baseCost:
          type: number
          format: float
          minimum: 0
          description: Base cost calculation
        taxes:
          type: number
          format: float
          minimum: 0
          description: Applicable taxes
        totalAmount:
          type: number
          format: float
          minimum: 0
          description: Total amount to pay
        status:
          type: string
          enum:
            - PENDING
            - PAID
            - OVERDUE
            - CANCELLED
          description: Payment status
        dueDate:
          type: string
          format: date
          description: Payment due date
        paidAt:
          type: string
          format: date-time
          nullable: true
          description: Payment timestamp
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
      required:
        - id
        - unitId
        - periodId
        - consumption
        - baseCost
        - taxes
        - totalAmount
        - status
        - dueDate
security:
  - bearerAuth: []
tags:
  - name: Authentication
    description: User authentication and authorization endpoints
  - name: Users
    description: User management endpoints
  - name: Condominiums
    description: Condominium management endpoints
  - name: Blocks
    description: Block management within condominiums
  - name: Units
    description: Unit management within blocks
  - name: Residents
    description: Resident management endpoints
  - name: Periods
    description: Billing period management endpoints
  - name: Readings
    description: Water meter reading endpoints
  - name: Bills
    description: Billing and payment endpoints
  - name: Admin
    description: Administrative endpoints
paths:
  /auth/login:
    post:
      summary: User login
      description: Authenticate user with email and password to obtain access tokens
      tags:
        - Authentication
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: User email address
                  example: admin@aquaflow.com
                password:
                  type: string
                  format: password
                  description: User password
                  example: SuperAdmin123!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  accessToken:
                    type: string
                    description: JWT access token
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  refreshToken:
                    type: string
                    description: JWT refresh token
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  expiresIn:
                    type: string
                    description: Token expiration time
                    example: 1h
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          description: Too many login attempts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /auth/refresh:
    post:
      summary: Refresh access token
      description: Generate a new access token using a valid refresh token
      tags:
        - Authentication
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  description: Valid refresh token
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    description: New JWT access token
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  expiresIn:
                    type: string
                    description: Token expiration time
                    example: 1h
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /auth/logout:
    post:
      summary: User logout
      description: Log out the authenticated user and invalidate the session
      tags:
        - Authentication
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully
        '401':
          description: Unauthorized - Invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /auth/me:
    get:
      summary: Get current user profile
      description: Retrieve the profile information of the authenticated user
      tags:
        - Authentication
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    example: 123e4567-e89b-12d3-a456-426614174000
                  email:
                    type: string
                    format: email
                    example: admin@aquaflow.com
                  name:
                    type: string
                    example: Super Administrator
                  phone:
                    type: string
                    nullable: true
                    example: +1-555-0100
                  role:
                    type: string
                    enum:
                      - SUPER_ADMIN
                      - ADMIN
                      - ANALYST
                      - EDITOR
                      - RESIDENT
                    example: SUPER_ADMIN
                  isActive:
                    type: boolean
                    example: true
                  createdAt:
                    type: string
                    format: date-time
                    example: '2024-01-01T00:00:00.000Z'
                  condominiumUsers:
                    type: array
                    description: Condominiums the user has access to
                    items:
                      type: object
                      properties:
                        condominiumId:
                          type: string
                          format: uuid
                        role:
                          type: string
                          enum:
                            - SUPER_ADMIN
                            - ADMIN
                            - ANALYST
                            - EDITOR
                            - RESIDENT
                        condominium:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            name:
                              type: string
                            address:
                              type: string
                            isActive:
                              type: boolean
        '401':
          description: Unauthorized - Invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /condominiums/{id}:
    get:
      summary: Get condominium details
      description: Retrieve detailed information about a specific condominium
      tags:
        - Condominiums
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Condominium unique identifier
          example: 123e4567-e89b-12d3-a456-426614174000
      responses:
        '200':
          description: Condominium details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Condominium'
        '401':
          description: Unauthorized - Invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - No access to this condominium
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Condominium not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
